<!DOCTYPE html>
<html>
  <head>
    <title>{{ title }}</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>

    <canvas id="plot" width="1500" height="600"></canvas>

    <script type="text/javascript" src="http://localhost:3000/nowjs/now.js"></script>

    <script type="text/javascript">


      var ctx = document.getElementById('plot').getContext('2d');
      ctx.fillStyle = 'rgb(0,0,0)';
      ctx.lineWidth = 1;
      var frames = [];
      var multiplicator = 1;

      now.data = function(d) {

        d.frames.forEach(function(frame) {
          var channels = frame.channels.map(function(c) {
            return 600 - (c * 600 / 1024);
          });
          frames.push({ channels: channels });

          if(frames.length > 1500/multiplicator)
            frames.shift();
        });

        clear();
        draw(0, 'rgb(255, 0, 0)');
        draw(1, 'rgb(0, 255, 0)');
        draw(2, 'rgb(0, 0, 255)');
        draw(3, 'rgb(255, 255, 0)');
        draw(4, 'rgb(255, 0, 255)');
        draw(5, 'rgb(0, 255, 255)');

      };

      var clear = function() {
        ctx.clearRect(0, 0, 1500, 620);
      };

      var draw = function(channel, color) {
        ctx.strokeStyle = color;
        ctx.beginPath();
        ctx.moveTo(0, frames[0].channels[channel]);
        
        for(var x=1; x<frames.length; x++) {
          ctx.lineTo(multiplicator*x, frames[x].channels[channel]);
        }
        ctx.stroke();
      };

      now.error = function(e) {
        console.log(e);
      };

    </script>

  </body>
</html>